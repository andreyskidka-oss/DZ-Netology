# Задание 4: Анализ ошибки в функции

## Исходный код функции

```python
DEFAULT_USER_COUNT = 3

def delete_and_return_last_user(region, default_list=['A100', 'A101', 'A102']):
    """
    Удаляет из списка default_list последнего пользователя
    и возвращает ID нового последнего пользователя.
    """
    element_to_delete = default_list[-1]
    default_list.remove(element_to_delete)
    return default_list[DEFAULT_USER_COUNT-2]
```

## Что происходит при вызовах функции?

### Первый вызов:
```python
result = delete_and_return_last_user(1)
print(result)  # Вывод: 'A101'
```

**Что происходит внутри функции:**
1. `default_list` = `['A100', 'A101', 'A102']` (первоначальное значение)
2. `element_to_delete` = `'A102'` (последний элемент)
3. Удаляем `'A102'` из списка
4. Список становится: `['A100', 'A101']`
5. Возвращаем элемент с индексом `DEFAULT_USER_COUNT-2` = `3-2` = `1`
6. `default_list[1]` = `'A101'`

✅ **Первый вызов работает корректно**

---

### Второй вызов:
```python
result = delete_and_return_last_user(1)  # ОШИБКА: IndexError: list index out of range
```

**Что происходит внутри функции:**
1. `default_list` = `['A100', 'A101']` ❗ **Важно: это ТОТ ЖЕ список, который был изменен после первого вызова**
2. `element_to_delete` = `'A101'` (последний элемент)
3. Удаляем `'A101'` из списка
4. Список становится: `['A100']`
5. Пытаемся вернуть элемент с индексом `1`
6. Но в списке только 1 элемент (индекс 0) → **ОШИБКА**

❌ **Второй вызов приводит к ошибке**

---

## Объяснение проблемы

### 1. Что означает ошибка "list index out of range"?

Ошибка `IndexError: list index out of range` возникает, когда программа пытается обратиться к элементу списка по индексу, который не существует в этом списке.

**Пример:**
```python
my_list = [10, 20, 30]
print(my_list[5])  # ОШИБКА: в списке всего 3 элемента, индекс 5 не существует
```

### 2. Почему проблема возникает только при втором вызове?

Проблема связана с особенностью работы Python с **изменяемыми значениями по умолчанию** для параметров функции.

**Ключевой момент:** В Python параметры со значениями по умолчанию вычисляются только один раз - в момент определения функции, а не при каждом вызове.

```python
def problematic_function(param=[]):  # Список создается ОДИН РАЗ
    param.append(1)
    return param

print(problematic_function())  # [1]
print(problematic_function())  # [1, 1] - список сохраняет изменения!
print(problematic_function())  # [1, 1, 1] - и так далее...
```

В нашем случае:
- Список `['A100', 'A101', 'A102']` создается **один раз** при определении функции
- При первом вызове мы удаляем из него элемент
- При втором вызове используется **уже измененный список**, а не новый

---

## Как исправить проблему?

### Решение 1: Использование `None` как значения по умолчанию

```python
DEFAULT_USER_COUNT = 3

def delete_and_return_last_user(region, default_list=None):
    """
    Удаляет из списка default_list последнего пользователя
    и возвращает ID нового последнего пользователя.
    """
    if default_list is None:
        default_list = ['A100', 'A101', 'A102']
    
    element_to_delete = default_list[-1]
    default_list.remove(element_to_delete)
    
    return default_list[DEFAULT_USER_COUNT-2]
```

**Почему это работает:**
- `None` - неизменяемое значение
- При каждом вызове проверяем: если `default_list` равен `None`, создаем новый список
- Каждый вызов получает свой собственный список

### Решение 2: Создание копии списка

```python
import copy

DEFAULT_USER_COUNT = 3

def delete_and_return_last_user(region, default_list=['A100', 'A101', 'A102']):
    """
    Удаляет из списка default_list последнего пользователя
    и возвращает ID нового последнего пользователя.
    """
    # Создаем копию списка, чтобы не изменять оригинал
    working_list = copy.copy(default_list)
    
    element_to_delete = working_list[-1]
    working_list.remove(element_to_delete)
    
    return working_list[DEFAULT_USER_COUNT-2]
```

---

## Тестирование исправленной функции

```python
# Тестируем исправленную функцию
print("Первый вызов:", delete_and_return_last_user(1))  # 'A101'
print("Второй вызов:", delete_and_return_last_user(1))  # 'A101'
print("Третий вызов:", delete_and_return_last_user(1))  # 'A101'

# Каждый раз функция работает с новым списком!
```

## Выводы

1. **Ошибка "list index out of range"** означает попытку доступа к несуществующему индексу списка.

2. **Проблема возникает из-за** того, что изменяемые объекты (списки, словари) в параметрах по умолчанию создаются один раз и сохраняют изменения между вызовами.

3. **Лучшая практика:** Используйте `None` в качестве значения по умолчанию для изменяемых параметров, и создавайте новый объект внутри функции при необходимости.

4. **Правило запомнить:** Никогда не используйте изменяемые объекты (списки, словари, множества) в качестве значений по умолчанию для параметров функции, если не понимаете последствий.
